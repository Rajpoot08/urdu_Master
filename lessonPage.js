document.addEventListener('contextmenu',function(e){e.preventDefault()});document.addEventListener('keydown',function(e){if(e.code==='F12'){e.preventDefault();alert("Developer tools are disabled on this page.")}
if((e.ctrlKey||e.metaKey)&&e.shiftKey&&e.code==='KeyI'){e.preventDefault();alert("Developer tools are disabled on this page.")}
if((e.ctrlKey||e.metaKey)&&e.shiftKey&&e.code==='KeyJ'){e.preventDefault();alert("Developer tools are disabled on this page.")}
if((e.ctrlKey||e.metaKey)&&e.code==='KeyU'){e.preventDefault();alert("Viewing page source is disabled.")}
if((e.ctrlKey||e.metaKey)&&e.shiftKey&&e.code==='KeyC'){e.preventDefault();alert("Developer tools (Inspect Element) are disabled on this page.")}
if((e.metaKey||e.altKey)&&e.code==='KeyJ'){e.preventDefault();alert("Developer tools are disabled on this page.")}});const allTypingTexts=[["ا س د ف گ ھ ج ک ل ل ک ج ھ گ ف د س ا گ ھ ج ک ل ا س د ف گ اس گا ھل لس فھ فد دل وگ بک دا فک ھا کل جس لس اک وف وگ بج بک سل ھف گل ھد فس اف دج بج مل فا جا جل فل ف سو دھ لھ دک ا صاف جاگ لاگ بگ ساد جاد داد داگ گاد لاد دفا دگا دگا دجا دجال جادل داجل ھاجل ھاگل ھافل ھاجد جاھد جاھل ھاگل جاسل ساجل ھاجل ھاسل کافل فاکل کاسل ساکل گافل فاگل ل سک حد اد ب فاک ساھ جاس ھاف ادس اسھ اجس وجس ولف ادل جاگ سلج فھا جاھ وجا گا ل دف دج اھ داس گاس کاف ساج فاھ اسگ الس اکف جس کف دال جاں جاس نھا فاھ فا کا ل فد وک گف ساگ ساد فاد کاس لکد ادف اسد افد اکس بس بج لاو لاج رجا لھا گاھ گا گا دگ دھ لد لف فاک ھاس جاھ فاس ادک اف"],["پ ت ی ع ق ر ع وہ وہ پہ پہ پی وہ تہ رہ پر قہ ہپ قو یو ہے ہت وع تو ہو ہق وع وت پو وو وپ ورت رو عو پے تے رت ورق ے قے پرق پرت ترپ لیتو ر عے یہ رے قوت قہر رہق پہیے عرق وہ تو ر پہر سیر قوتو پلسہ توڑے روئے عتر تر عرے فولیو ءر ہوئے پوتو پوتی پوہے قوئے یو روتے تولی و تولی و پوتے یوتی پوئے ہوئے پپ وپ ء ے و عف قتو پورے پر رو قع پو ترے وقع پرت عرت قپ پ روئے پو قو تپ رپ پ ت ف عت عقو تو یر ورع پرے ترک قرت ووق ترپ تپ قت قوتے پو عق ق و ع ر ت ے ئی ی ہ پ پ ہ ی ئی ے ت ر ع و ق ے ئی ی ہ پ"],["ز ش چ ط ب ن م م ن ب ط چ ش ز ط ب ن م ز ش چ ط ب ن نب شم جن مب نب شط بج نج طمن سز شسر باء رج ز نم نش بط طمش تمش م ط بم نم من شن طب نط زط شج نش جش بز ن ب رج ز نب نز بج شمن تمن ج طج زم بن نن جب بط چن طچ مش نش طز ن ط ش ء نط من شن لمن ش چم چم طن نف شض چط بچ چچ بش نز چز چم ط ش نچ ب طمض زم"],["آ ص ڑ غ ح ض خ خ ض ح غ ڑ ص آ غ ح ض خ آ ص ڑ خ صخ صخ حض حخ ضح حخ دح ع ع ح آ خض خض خص آص آغص آص ص آح أص صخ ذخ ضح خص خ عخ ع ص خ حص خص ذص آح آخص آص ح ع أع حخ حخ صخ حص صح غض غص خ ح خض حفض ر آح آغص آح ح خ غ خ غخ صح صح حخ غخ غص ح خ حخ حفض ر آح آغص آح رح ع غ آص صخ غخ خص آخ صخ ض غخ آغ غخ ص ص خ آص آغص آغص آص حج شخ خص ضخ رح ص ذخص حص حخ ح خ غ حخ ع غخ ضخ ضخ ص صخ ضخ ضخ حخ ذحص خص حخ خ ع صخ ع ع صخ ضخ ص خص ضخ ضخ حخ ذخص خص خص ص خ ذص صخ ص صخ ضخ خ غخ ضخ ضخ حخ ذحص خص خص ص خ ذص صخ ص درو رحم رح رح صخ ضخ ص عج ع ذخص حفض حفض حفض خ خ"],["ڑ ٹھ ئے ء ء ئے ٹھ ڑ ئے ء ڑ ٹھ ئے ء و ؤ ژو ئے ڈ ڈو وڑ لو ؤ ؤ ور وڑے ؤ ور وڑے ؤر وٹ وژ ز ژ ور و وے ژے ق وہ ر رہ ژہ ژط ٹرے ژو ر ٹ ژے وہ ور ور ٹ رو ورٹ ٹ ؤ زو وژ ژو ٹ رہ وہ ورٹ ٹرے کرو رٹ ہ ڈ ژے ہ وژ ٹوژ ے ژے وڑے ئے وڑے وڑے وے ژے ژش لو رو ع ژز ٹرے ٹورے ژے ع و ور ژ"],["ژ ث ٹ ں ؤ ۃ ۃ ؤ ں ٹ ث ژ ں ؤ ۃ ژ ث ٹ ں ب ذ ذط ذ ذط ذط ذ ث ط ذذ ذ ث ذط ذ ط شذ زذ ذ ش ظ ظب ظت د ذذ ذظ ظ شذ ذ ذط ظ ذت د شذ ث ذظ د اُ شُذ اُظ ذ ظ ث ش ظذ ت ذث ظت ت ش ظ بط د ذت ت ظذ ظط بط د بں اُث د ت ژ ژ ظژ ژ ذط ظں ژ ژ پ ب ژ ذ ژ ظذ ظژ بث ظط ذذ ذط ظ ژ"],[" بھی صرف ہے تھے تھا ہوں ہونا کرتا کرنا کہتا کہنا آنا جانا دیکھنا لینا دینا چلنا بولناپاکستان زندہ باد، اسلام علیکم، لاہور کراچی، پشاور کوئٹہ، پاکستان ترقی، علم روشنی، خوبصورت پھول، محنت کامیابی، اردو زبان، ٹائپنگ سیکھیں، کمپیوٹر استعمال، روزانہ مشق، وقت کی قدر، صاف ستھرا۔ کھانا پینا سننا سوچنا سمجھنا لکھنا پڑھنا کھیلنا سونا کے کا کی میں پر سے کو تک کے بعد کے پہلے اگر کیونکہ اور یا لیکن تاکہ جب جیسے حالانکہ بلکہ اگرچہ باوجود ہرگز ضرور تقریباً پانی کھانا کپڑے جوتے کتاب قلم دروازہ کھڑکی کرسی میز گاڑی سائیکل موبائل کمپیوٹر ٹی وی بیگ دکان اسکول گھر دفتر راستہ سڑک پل بازار مسجد آدمی عورت بچہ ماں باپ بہن بھائی دوست شوہر بیوی استاد شاگرد ملازم مالک پڑوسی ڈاکٹر انجینئر نرس پولیس فوجی کسان کاریگر انسان قوم لوگ وقت دن رات صبح شام آج کل موسم بارش سردی گرمی ہوا سورج چاند ستارہ آسمان زمین درخت پھول رنگ سفید کالا نیلا سبز سرخ"],["میں تم وہ ہم یہ آپ میرا تیرا اس ان کچھ سب کوئی ہر کیوں کہاں کب کیا کیسے ہاں نہیں جی شاید بھی صرف ہے تھے تھا ہوں ہونا کرتا کرنا کہتا کہنا آنا جانا دیکھنا لینا دینا چلنا بولنا کھانا پینا سننا سوچنا سمجھنا لکھنا پڑھنا کھیلنا سونا کے کا کی میں پر سے کو تک کے بعد کے پہلے اگر کیونکہ اور یا لیکن تاکہ جب جیسے حالانکہ بلکہ اگرچہ باوجود ہرگز ضرور تقریباً پانی کھانا کپڑے جوتے کتاب قلم دروازہ کھڑکی کرسی میز گاڑی سائیکل موبائل کمپیوٹر ٹی وی بیگ دکان اسکول گھر دفتر راستہ سڑک پل بازار مسجد آدمی عورت بچہ ماں باپ بہن بھائی دوست شوہر بیوی استاد شاگرد ملازم مالک پڑوسی ڈاکٹر انجینئر نرس پولیس فوجی کسان کاریگر انسان قوم لوگ وقت دن رات صبح شام آج کل موسم بارش سردی گرمی ہوا سورج چاند ستارہ آسمان زمین درخت پھول رنگ سفید کالا نیلا سبز سرخ","میرا وطن پاکستان دنیا کے خوبصورت ممالک میں سے ایک ہے پاکستان 14 اگست 1947 کو آزاد ہوا یہ آزادی قائداعظم محمد علی جناح کی قیادت اور لاکھوں مسلمانوں کی قربانیوں کے نتیجے میں حاصل ہوئی پاکستان ایک اسلامی جمہوری ملک ہے جہاں مسلمان آزادانہ اپنی زندگی اسلام کے اصولوں کے مطابق گزار سکتے ہیں پاکستان کو اللہ تعالیٰ نے ہر نعمت سے نوازا ہے یہاں چاروں موسم آتے ہیں یہاں کے میدان پہاڑ دریا صحرا اور خوبصورت وادیاں پاکستان کی خوبصورتی میں اضافہ کرتے ہیں پاکستان میں گندم چاول کپاس گنے اور دیگر فصلیں پیدا ہوتی ہیں پاکستان کے لوگ محنتی اور جفاکش ہیں وہ اپنے وطن سے محبت کرتے ہیں پاکستان کے چار صوبے ہیں پنجاب سندھ خیبر پختونخوا اور بلوچستان ہر صوبے کی اپنی ثقافت زبان اور روایات ہیں لیکن سب پاکستانی ایک دوسرے سے محبت کرتے ہیں اردو پاکستان کی قومی زبان ہے جو سب کو آپس میں جوڑتی ہے پاکستان کا دارالحکومت اسلام آباد ہے جو ایک خوبصورت اور جدید شہر ہے پاکستان ایک ایٹمی طاقت ہے اور اس کی فوج دنیا کی بہترین افواج میں شمار ہوتی ہے ہماری فوج نے ہمیشہ وطن کا دفاع کیا ہے اور دشمنوں کے ناپاک عزائم کو ناکام بنایا ہے ہم اپنے شہیدوں کو سلام پیش کرتے ہیں جنہوں نے وطن کے لیے اپنی جانیں قربان کیں تعلیم پاکستان کی ترقی کی کنجی ہے ہمیں چاہیے کہ ہم اپنے بچوں کو زیور تعلیم سے آراستہ کریں تاکہ وہ اچھے شہری بن سکیں اور ملک کی ترقی میں اپنا کردار ادا کریں پاکستان میں بہت سے اسکول کالج اور یونیورسٹیاں موجود ہیں جو تعلیم کے فروغ کے لیے کام کر رہی ہیں پاکستانی نوجوان باصلاحیت ہیں اور دنیا بھر میں اپنے ہنر کا لوہا منوا چکے ہیں ہمیں اپنے وطن کو صاف ستھرا رکھنا چاہیے اور ماحول کو آلودگی سے بچانا چاہیے ہم سب کو مل کر پاکستان کو ایک مثالی ملک بنانا ہے جہاں امن خوشحالی اور ترقی ہو ہمیں چاہیے کہ ہم ایمانداری محنت اور دیانتداری سے کام لیں اور اپنے ملک کا نام دنیا بھر میں روشن کریں ہم سب کا فرض ہے کہ اپنے وطن سے سچی محبت کریں اور ہر حال میں اس کی خدمت کریں پاکستان زندہ باد"]];const lessonInfo=[{id:'1.1',name:'Row ا س د ف گ ھ ج ک  ل Home',time:'3 منٹ',completed:!1},{id:'1.2',name:' Row ق و ع ر ت ے ئی ی ہ پ  Upper',time:'3 - 5 منٹ',completed:!1},{id:'1.3',name:'Rowز ش چ ط ب ن م  Lower',time:'3 منٹ',completed:!1},{id:'1.4',name:'Row آ  ص  ڑ  غ ح ض خ   Shift Home',time:'3 منٹ',completed:!1},{id:'1.5',name:'Row ڑ ٹ  ھ  ئ  ے ء Shift Upper ',time:'3 - 5 منٹ',completed:!1},{id:'1.6',name:'Row  ژ ث   بسم اللہ ں    ذ ظ  Shift Lower ',time:'3 منٹ',completed:!1},{id:'1.7',name:'لفظی مشق',time:'3 - 5 منٹ',completed:!1},{id:'1.8',name:' مشق ',time:'5 - 8 منٹ',completed:!1}];const textDisplay=document.getElementById('text-display');const textInput=document.getElementById('text-input');const startResetButton=document.getElementById('start-reset-button');const messageBox=document.getElementById('message-box');const messageBoxText=document.getElementById('message-box-text');const messageBoxCloseButton=document.getElementById('message-box-close');const messageBoxOverlay=document.getElementById('message-box-overlay');const timerDisplay=document.getElementById('timer-display');const durationButtonsContainer=document.getElementById('duration-buttons');const cancelIcon=document.getElementById('cancel-icon');const cancelPopup=document.getElementById('cancel-popup');const cancelPopupOverlay=document.getElementById('cancel-popup-overlay');const gotoHomeBtn=document.getElementById('goto-home-btn');const nextLessonBtn=document.getElementById('next-lesson-btn');const lessonPopup=document.getElementById('lesson-popup');const lessonPopupOverlay=document.getElementById('lesson-popup-overlay');const lessonSelectionList=document.getElementById('lesson-selection-list');let currentTextArray=[];let currentText='';let charIndex=0;let absoluteCharIndex=0;let mistakes=0;let timerCountdown;let intervalId;let isTyping=!1;let startTime;let selectedDuration=120;let totalCorrectCharactersTyped=0;let currentLessonIndex=0;const keyMap={'`':{keyId:'key-`',shift:!1},'~':{keyId:'key-`',shift:!0},'1':{keyId:'key-1',shift:!1},'!':{keyId:'key-1',shift:!0},'2':{keyId:'key-2',shift:!1},'@':{keyId:'key-2',shift:!0},'3':{keyId:'key-3',shift:!1},'#':{keyId:'key-3',shift:!0},'4':{keyId:'key-4',shift:!1},'$':{keyId:'key-4',shift:!0},'5':{keyId:'key-5',shift:!1},'%':{keyId:'key-5',shift:!0},'6':{keyId:'key-6',shift:!1},'^':{keyId:'key-6',shift:!0},'7':{keyId:'key-7',shift:!1},'&':{keyId:'key-7',shift:!0},'8':{keyId:'key-8',shift:!1},'٭':{keyId:'key-8',shift:!0},'9':{keyId:'key-9',shift:!1},'(':{keyId:'key-9',shift:!0},'0':{keyId:'key-0',shift:!1},')':{keyId:'key-0',shift:!0},'-':{keyId:'key--',shift:!1},_:{keyId:'key--',shift:!0},'=':{keyId:'key-=',shift:!1},'+':{keyId:'key-=',shift:!0},'ق':{keyId:'key-q',shift:!1},'و':{keyId:'key-w',shift:!1},'ؤ':{keyId:'key-w',shift:!0},'ع':{keyId:'key-e',shift:!1},'ۃ':{keyId:'key-e',shift:!0},'ر':{keyId:'key-r',shift:!1},'ڑ':{keyId:'key-r',shift:!0},'ت':{keyId:'key-t',shift:!1},'ٹ':{keyId:'key-t',shift:!0},'ے':{keyId:'key-y',shift:!1},'ۓ':{keyId:'key-y',shift:!0},'ء':{keyId:'key-u',shift:!1},'ی':{keyId:'key-i',shift:!1},'ئ':{keyId:'key-i',shift:!0},'ہ':{keyId:'key-o',shift:!1},'ۃ':{keyId:'key-o',shift:!0},'پ':{keyId:'key-p',shift:!1},'[':{keyId:'key-[',shift:!1},'{':{keyId:'key-[',shift:!0},']':{keyId:'key-]',shift:!1},'}':{keyId:'key-]',shift:!0},'\\':{keyId:'key-\\\\',shift:!1},'|':{keyId:'key-\\\\',shift:!0},'ا':{keyId:'key-a',shift:!1},'آ':{keyId:'key-a',shift:!0},'س':{keyId:'key-s',shift:!1},'ص':{keyId:'key-s',shift:!0},'د':{keyId:'key-d',shift:!1},'ڈ':{keyId:'key-d',shift:!0},'ف':{keyId:'key-f',shift:!1},'۔':{keyId:'key-f',shift:!0},'گ':{keyId:'key-g',shift:!1},'غ':{keyId:'key-g',shift:!0},'ح':{keyId:'key-h',shift:!0},'ج':{keyId:'key-j',shift:!1},'ض':{keyId:'key-j',shift:!0},'ک':{keyId:'key-k',shift:!1},'خ':{keyId:'key-k',shift:!0},'ل':{keyId:'key-l',shift:!1},'”':{keyId:'key-l',shift:!0},'؛':{keyId:'key-;',shift:!1},':':{keyId:'key-;',shift:!0},"'":{keyId:"key-'",shift:!1},'"':{keyId:"key-'",shift:!0},'ز':{keyId:'key-z',shift:!1},'ذ':{keyId:'key-z',shift:!0},'ش':{keyId:'key-x',shift:!1},'ژ':{keyId:'key-x',shift:!0},'چ':{keyId:'key-c',shift:!1},'ث':{keyId:'key-c',shift:!0},'ط':{keyId:'key-v',shift:!1},'ظ':{keyId:'key-v',shift:!0},'ب':{keyId:'key-b',shift:!1},'ن':{keyId:'key-n',shift:!1},'ں':{keyId:'key-n',shift:!0},'م':{keyId:'key-m',shift:!1},'،':{keyId:'key-,',shift:!1},'<':{keyId:'key-,',shift:!0},'>':{keyId:'key-.',shift:!0},'/':{keyId:'key-/',shift:!1},'?':{keyId:'key-/',shift:!0},' ':{keyId:'key-space',shift:!1}};const urduConversionMap={'q':'ق','Q':'صلی اللہ علیہ وسلم','w':'و','W':'ؤ','e':'ع','E':'ۃ','r':'ر','R':'ڑ','t':'ت','T':'ٹ','y':'ے','Y':'ۓ','u':'ء','U':'،','i':'ی','I':'ئ','o':'ہ','O':'ۃ','p':'پ','P':'،','a':'ا','A':'آ','s':'س','S':'ص','d':'د','D':'ڈ','f':'ف','F':'۔','g':'گ','G':'غ','h':'ہ','H':'ح','j':'ج','J':'ض','k':'ک','K':'خ','l':'ل','L':'”',';':'؛',':':':',"'":"'",'"':'"','z':'ز','Z':'ذ','x':'ش','X':'ژ','c':'چ','C':'ث','v':'ط','V':'ظ','b':'ب','B':'بسم اللہ الرحمن الرحیم','n':'ن','N':'ں','m':'م','M':'صلی اللہ علیہ وسلم',',':'،','<':'<','.':'۔','>':'>','/':'/','?':'؟'};let activeKeyElements=[];const segmenter=new Intl.Segmenter('ur',{granularity:'grapheme'});let fullTextGraphemes=[];function convertInputToUrdu(inputString){let result='';for(const char of inputString){result+=urduConversionMap[char]||char}
return result}
function showMessageBox(message){messageBoxText.innerHTML=message;messageBox.style.display='flex';messageBoxOverlay.style.display='block'}
function hideMessageBox(){messageBox.style.display='none';messageBoxOverlay.style.display='none'}
function showCancelPopup(){if(isTyping)clearInterval(intervalId);cancelPopup.style.display='flex';cancelPopupOverlay.style.display='block'}
function hideCancelPopup(){cancelPopup.style.display='none';cancelPopupOverlay.style.display='none';if(isTyping){intervalId=setInterval(updateTimerAndCountdown,1000);textInput.focus()}}
function showLessonPopup(){lessonPopup.style.display='flex';lessonPopupOverlay.style.display='block';renderLessonList()}
function hideLessonPopup(){lessonPopup.style.display='none';lessonPopupOverlay.style.display='none';textInput.focus()}
function renderLessonList(){lessonSelectionList.innerHTML='';lessonInfo.forEach((info,index)=>{const lessonItem=document.createElement('a');lessonItem.href='#';lessonItem.classList.add('lesson-item');if(info.completed){lessonItem.classList.add('completed')}
if(index===currentLessonIndex){lessonItem.classList.add('active')}
lessonItem.dataset.lessonIndex=index;lessonItem.innerHTML=`
                    <div class="status-icon">
                        ${info.completed ? '<svg class="checkmark" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>' : '<div class="radio-button"></div>'}
                    </div>
                    <div class="lesson-number">${info.id}</div>
                    <div class="lesson-name">${info.name}</div>
                    <div class="lesson-time">${info.time}</div>
                `;lessonItem.addEventListener('click',(event)=>{event.preventDefault();selectLesson(index);hideLessonPopup()});lessonSelectionList.appendChild(lessonItem)})}
function selectLesson(index){currentLessonIndex=index;currentTextArray=allTypingTexts[currentLessonIndex];resetTest();textDisplay.innerHTML=`اپنا سبق شروع کرنے کے لیے  Start Lesson  پر کلک کریں!`;lessonInfo.forEach((info,i)=>info.completed=(i<index));localStorage.setItem('selectedLessonIndex',currentLessonIndex);renderLessonList()}
function clearKeyboardHighlight(){activeKeyElements.forEach(el=>el.classList.remove('active'));activeKeyElements=[]}
function updateKeyboardHighlight(){clearKeyboardHighlight();const targetChar=fullTextGraphemes[absoluteCharIndex+charIndex];if(targetChar){const charInfo=keyMap[targetChar];if(charInfo){const keyElement=document.getElementById(charInfo.keyId);if(keyElement){keyElement.classList.add('active');activeKeyElements.push(keyElement);if(charInfo.shift){const leftShift=document.getElementById('key-left-shift');const rightShift=document.getElementById('key-right-shift');if(leftShift){leftShift.classList.add('active');activeKeyElements.push(leftShift)}
if(rightShift){rightShift.classList.add('active');activeKeyElements.push(rightShift)}}}}}}
const segmentLength=150;function loadTextSegment(){const start=absoluteCharIndex;const end=Math.min(start+segmentLength,fullTextGraphemes.length);currentText=fullTextGraphemes.slice(start,end).join('');charIndex=0;if(start>=fullTextGraphemes.length&&isTyping){endTest()}
renderText()}
function startTest(){absoluteCharIndex=0;mistakes=0;totalCorrectCharactersTyped=0;isTyping=!0;clearInterval(intervalId);const randomTextIndex=Math.floor(Math.random()*currentTextArray.length);const selectedText=currentTextArray[randomTextIndex];fullTextGraphemes=Array.from(segmenter.segment(selectedText)).map(s=>s.segment);loadTextSegment();textInput.value='';textInput.disabled=!1;textInput.focus();startResetButton.textContent='Reset Lesson';durationButtonsContainer.querySelectorAll('button').forEach(btn=>btn.disabled=!0);timerCountdown=selectedDuration;updateTimerDisplay();startTime=new Date().getTime();intervalId=setInterval(updateTimerAndCountdown,1000);updateKeyboardHighlight()}
function resetTest(){clearInterval(intervalId);isTyping=!1;textInput.value='';textInput.disabled=!0;startResetButton.textContent='Start Lesson';startResetButton.disabled=!1;durationButtonsContainer.querySelectorAll('button').forEach(btn=>btn.disabled=!1);timerCountdown=selectedDuration;updateTimerDisplay();textDisplay.innerHTML=`اپنا سبق شروع کرنے کے لیے Start Lesson پر کلک کریں!`;clearKeyboardHighlight();hideMessageBox()}
function updateTimerAndCountdown(){timerCountdown--;updateTimerDisplay();if(timerCountdown<=0){endTest()}}
function formatTime(seconds){const minutes=Math.floor(seconds/60);const remainingSeconds=seconds%60;return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`}
function updateTimerDisplay(){timerDisplay.textContent=formatTime(timerCountdown)}
function handleInput(event){if(!isTyping)return;textInput.value=convertInputToUrdu(textInput.value);const typedGraphemes=Array.from(segmenter.segment(textInput.value)).map(s=>s.segment);const targetGraphemesSegment=Array.from(segmenter.segment(currentText)).map(s=>s.segment);charIndex=typedGraphemes.length;if(charIndex>=targetGraphemesSegment.length){let correctInSegment=0;for(let i=0;i<targetGraphemesSegment.length;i++){if(typedGraphemes[i]===targetGraphemesSegment[i]){correctInSegment++}}
totalCorrectCharactersTyped+=correctInSegment;absoluteCharIndex+=targetGraphemesSegment.length;textInput.value='';loadTextSegment()}
renderText();updateKeyboardHighlight();if(absoluteCharIndex>=fullTextGraphemes.length){endTest()}}
function renderText(){textDisplay.innerHTML='';const targetGraphemesSegment=Array.from(segmenter.segment(currentText)).map(s=>s.segment);const typedGraphemesSegment=Array.from(segmenter.segment(textInput.value)).map(s=>s.segment);targetGraphemesSegment.forEach((char,index)=>{const span=document.createElement('span');span.textContent=char;if(index<typedGraphemesSegment.length){span.classList.add(char===typedGraphemesSegment[index]?'correct':'incorrect')}else if(index===typedGraphemesSegment.length){span.classList.add('current')}
textDisplay.appendChild(span)});const currentSpan=textDisplay.querySelector('.current');if(currentSpan){currentSpan.scrollIntoView({behavior:'smooth',block:'nearest'})}}
function endTest(){if(!isTyping)return;clearInterval(intervalId);isTyping=!1;textInput.disabled=!0;clearKeyboardHighlight();startResetButton.disabled=!1;startResetButton.textContent='نیا ٹیسٹ شروع کریں';durationButtonsContainer.querySelectorAll('button').forEach(btn=>btn.disabled=!1);const finalElapsedTime=selectedDuration-timerCountdown;let finalWPM=0;if(finalElapsedTime>0){finalWPM=Math.round((totalCorrectCharactersTyped/5)/(finalElapsedTime/60))}
let attemptedChars=absoluteCharIndex+charIndex;let finalAccuracy=0;if(attemptedChars>0){finalAccuracy=Math.round((totalCorrectCharactersTyped/attemptedChars)*100)}
showMessageBox(`Test Completed<br><br> WPM: ${Math.max(0, finalWPM)}<br>Accuracy: ${Math.max(0, Math.min(100, finalAccuracy))}%`)}
startResetButton.addEventListener('click',()=>{isTyping?resetTest():startTest()});textInput.addEventListener('input',handleInput);messageBoxCloseButton.addEventListener('click',hideMessageBox);messageBoxOverlay.addEventListener('click',hideMessageBox);cancelIcon.addEventListener('click',showCancelPopup);cancelPopupOverlay.addEventListener('click',hideCancelPopup);gotoHomeBtn.addEventListener('click',()=>{window.location='index.html'});nextLessonBtn.addEventListener('click',()=>{currentLessonIndex=(currentLessonIndex+1)%allTypingTexts.length;selectLesson(currentLessonIndex);hideCancelPopup()});durationButtonsContainer.addEventListener('click',(event)=>{const clickedButton=event.target.closest('button');if(clickedButton&&!isTyping){document.querySelectorAll('.duration-buttons button').forEach(btn=>btn.classList.remove('selected'));clickedButton.classList.add('selected');selectedDuration=parseInt(clickedButton.dataset.duration);timerCountdown=selectedDuration;updateTimerDisplay()}});window.onload=()=>{textInput.disabled=!0;timerCountdown=selectedDuration;updateTimerDisplay();document.querySelector(`.duration-buttons button[data-duration="${selectedDuration}"]`).classList.add('selected');const storedLessonIndex=localStorage.getItem('selectedLessonIndex');if(storedLessonIndex!==null&&!isNaN(parseInt(storedLessonIndex))){const parsedIndex=parseInt(storedLessonIndex);if(parsedIndex>=0&&parsedIndex<allTypingTexts.length){currentLessonIndex=parsedIndex}}
selectLesson(currentLessonIndex);showLessonPopup()}